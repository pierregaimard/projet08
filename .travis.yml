language: php
php:
  - '7.4'

os: linux
dist: focal

# Git branches
branches:
  only:
    - /^feature.*$/

services:
  - mysql

install:
  - composer install
  - php bin/phpunit --group=none

before_script:
  # Prepare code coverage report for CodeClimate
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
  # Database
  - php bin/console doctrine:database:create --env=test
  - php bin/console doctrine:migrations:migrate --env=test --no-interaction

script: php bin/phpunit --coverage-clover clover.xml

after_script:
  # Send code coverage report to CodeClimate
  - ./cc-test-reporter after-build -t clover --exit-code $TRAVIS_TEST_RESULT

notifications:
  slack:
    secure: "nXrZ1fEkl6xCqXQYvKtpQ7muJu+uj4YwUfvEj/Y9Rx3fNM6hwfpUyBfFwJt8363imZZrNmeIdoIC0I+2nz2NtielWJvSxXUR/y0tLCVBnqbV9vsUBxDJA17ZmK9gJM1bgUzT2gWdj6iBAdY/y33YbOwcQB7nHK3VsX7+Wba+c8Q5QIALXjV5qsC7olIve1td7i67Ro9aaT97c7C+PnyNWWGKHlRTDhJb/km78/Frbz0LcCjHYiUn+TSzCw752/obZ4bJPDqj1R3Hte0faNA/qPB4gawsR/m7AuI5LK1iwXE888IVPzBH9qlORCEAmDBvOR8JC9EsYCc369jih5+slLMkR+gdqHOFh2C+87wWc+HSDYy2JHZGekpLOzHE8/2OvERosx6GAkibf5V/GvrijdD3qqZAi6ECnIOb397zEGJxiSGr+NzJ0LVlunbGVRqeR6X4x2lk9254s9587NOFKdVE3n0NJ+MBqLjhs57rg0E0vtcxECrRcaRNGdtSpFghfg+fpUhEXBhEaBWpoNqqvx5IhS5Z1aBlg4pU1FwgJhuAmW18O/ApmekA3LV3/2kEYax4jJB2F4kmWEEn4X9MxhzG3I4zeR9h7S2RujiKMVnI/zbBQBG3ouN+cG6WxS1YstsaWk+p2HIzBxyLCtYX4DOS+Yy3hBFqFfCbKrP9Ca0="